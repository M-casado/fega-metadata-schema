{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/M-casado/fega-metadata-schema/main/schemas/FEGA.protocol.json",
  "type": "object",
  "title": "FEGA protocol metadata schema",
  "meta:version": "0.0.0",
  "$async": true,
  "description": "A FEGA protocol.",
  "@context": [
    "./FEGA.common-definitions.json",
    {
      "entityDoc": "entities:FEGA.protocol.json#",
      "properties": "@nest"
    }
  ],
  "allOf": [
    {
      "title": "Base constraints for JSON-LD",
      "$ref": "./json-ld.org/FEGA.jsonld-schema.json"
    },
    {
      "title": "Compatibility with BioSchemas ComputationalWorkflow",
      "if": {
        "required": ["@type"],
        "properties": {
          "@type": {
              "anyOf": [
                { "const": "bioschemastypes:ComputationalWorkflow" },
                { "type": "array",
                  "contains": { "const": "bioschemastypes:ComputationalWorkflow" } }
              ]
            }
        }
      },
      "then": {
        "$comment": "These BioSchemas files were fetched from BioSchemas API. See https://github.com/EGA-archive/fega-metadata-schema/issues/6 for more details.",
        "$ref": "./bioschemas/ComputationalWorkflow_v1.1-DRAFT.json"
      }
    },
    {
      "title": "Compatibility with BioSchemas LabProtocol",
      "if": {
        "required": ["@type"],
        "properties": {
          "@type": {
            "anyOf": [
              { "const": "bioschemastypes:LabProtocol" },
              { "type": "array",
                "contains": { "const": "bioschemastypes:LabProtocol" } }
            ]
          }
        }
      },
      "then": {
        "$comment": "These BioSchemas files were fetched from BioSchemas API. See https://github.com/EGA-archive/fega-metadata-schema/issues/6 for more details.",
        "$ref": "./bioschemas/LabProtocol_v0.8-DRAFT.json"
      }
    }
  ],
  "$defs": {
    "protocolTypeEnum": {
      "type": "string",
      "anyOf": [
        {
          "enum": ["protocol", "prov:Plan", "bioschemastypes:ComputationalWorkflow"]
        },
        {
          "enum": ["protocol", "prov:Plan", "bioschemastypes:LabProtocol"]
        }
      ]
    },
    "computingRequirements": {
      "type": "object",
      "properties": {
        "memory": {
          "type": "string",
          "description": "Minimum memory (RAM) requirements (e.g., '8GB', '16GB')",
          "meta:sssomMappings": [
              {
                  "predicate_id": "skos:exactMatch",
                  "object_id": "schema:memoryRequirements",
                  "mapping_justification": "semapv:ManualMappingCuration",
                  "object_match_field": "rdfs:comment",
                  "subject_match_field": "rdfs:comment",
                  "author_id": ["orcid:0000-0002-7747-6256"],
                  "creator_id": ["orcid:0000-0002-7747-6256"],
                  "reviewer_id": [""],
                  "confidence": 1.0,
                  "mapping_date": "2025-08-08"
              }
          ],
          "pattern": "^[0-9]+(GB|MB|TB)$",
          "examples": ["4GB", "16GB", "128GB"]
        },
        "cpuCores": {
          "type": "number",
          "description": "Number of CPU cores needed to run the workflow",
          "minimum": 1,
          "examples": [2, 4, 8]
        },
        "gpuAcceleration": {
          "type": "boolean",
          "description": "Whether GPU acceleration is required",
          "examples": [true, false]
        },
        "storage": {
          "type": "string", 
          "description": "Amount of disk space required (e.g., '100GB', '1TB')",
          "meta:sssomMappings": [
              {
                  "predicate_id": "skos:exactMatch",
                  "object_id": "schema:storageRequirements",
                  "mapping_justification": "semapv:ManualMappingCuration",
                  "object_match_field": "rdfs:comment",
                  "subject_match_field": "rdfs:comment",
                  "author_id": ["orcid:0000-0002-7747-6256"],
                  "creator_id": ["orcid:0000-0002-7747-6256"],
                  "reviewer_id": [""],
                  "confidence": 1.0,
                  "mapping_date": "2025-08-08"
              }
          ],
          "pattern": "^[0-9]+(GB|MB|TB)$",
          "examples": ["50GB", "500GB", "2TB"]
        }
      }
    }
  },

  "properties": {
    "@type": {
      "anyOf": [
        {
          "$ref": "#/$defs/protocolTypeEnum"
        },
        {
          "type": "array",
          "items": {
            "$ref": "#/$defs/protocolTypeEnum"
          }
        }
      ]
    },
    
    "sameAs": {
      "$ref": "./FEGA.common-definitions.json#/$defs/sameAs"
    },

    "isBasedOn": {
      "$ref": "./FEGA.common-definitions.json#/$defs/isBasedOn",
      "$comment": "This is used when the protocol that it's referenced is not exactly the same: this protocol was a modification of the original one, or it was used as a base to create this protocol. E.g., changed parameters, or added new steps.",
      "meta:sssomMappings": [
        {
          "predicate_id": "skos:narrowMatch",
          "object_id": "https://datacite-metadata-schema.readthedocs.io/en/4.5/appendices/appendix-1/relationType/#isnewversionof",
          "mapping_justification": "semapv:ManualMappingCuration",
          "object_match_field": "rdfs:comment",
          "subject_match_field": "rdfs:comment",
          "author_id": ["orcid:0000-0002-7747-6256"],
          "creator_id": ["orcid:0000-0002-7747-6256"],
          "reviewer_id": [""],
          "confidence": 1.0,
          "mapping_date": "2025-08-08"
        }
      ]
    },

    "version": {
      "$ref": "./bioschemas/ComputationalWorkflow_v1.1-DRAFT.json#/properties/version"
    }
  }
}
